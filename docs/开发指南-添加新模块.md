# 开发指南 - 添加新模块

本文档介绍如何在ZXGK Court Automation Tool中添加新功能模块。

## 模块结构

每个功能模块应包含以下组件：

```
src/tasks/[module_name]/
├── __init__.py
├── task.py              # 任务实现
├── handlers/            # 业务逻辑处理器
│   ├── __init__.py
│   ├── navigation_handler.py
│   ├── form_handler.py
│   └── ...
└── config.py            # 步骤配置
```

## 步骤1: 创建任务类

在 `src/tasks/[module_name]/task.py` 创建任务类：

```python
from src.tasks.base_task import BaseTask, TaskStatus, TaskResult

class MyModuleTask(BaseTask):
    def __init__(self, task_id: str, config: dict):
        super().__init__(task_id, "我的模块", config)
        # 初始化handlers
        self.navigation_handler = NavigationHandler()

    async def execute(self, automation_engine) -> TaskResult:
        try:
            # 实现任务逻辑
            steps = get_steps()
            for step in steps:
                result = await self._execute_step(step, automation_engine)
                if not result:
                    return TaskResult(TaskStatus.FAILED, "步骤执行失败")

            return TaskResult(TaskStatus.SUCCESS, "执行成功")
        except Exception as e:
            return TaskResult(TaskStatus.FAILED, str(e), error=e)
```

## 步骤2: 创建处理器

在 `src/tasks/[module_name]/handlers/` 创建处理器：

```python
class NavigationHandler:
    async def navigate_to_page(self, url: str):
        # 实现导航逻辑
        pass
```

## 步骤3: 配置步骤

在 `src/tasks/[module_name]/config.py` 定义步骤：

```python
def get_steps():
    return [
        {
            "step_id": "nav_01",
            "name": "导航",
            "handler": "navigation_handler",
            "method": "navigate_to_page",
            "args": ["https://example.com"],
            "kwargs": {},
        },
        # 更多步骤...
    ]
```

## 步骤4: 创建GUI标签页

在 `src/ui/tabs/` 创建标签页：

```python
import tkinter as tk
from tkinter import ttk

class MyModuleTab:
    def __init__(self, parent):
        self.parent = parent
        self.frame = ttk.Frame(parent)
        self._setup_ui()

    def _setup_ui(self):
        # 创建UI组件
        pass
```

## 步骤5: 注册到主界面

在 `src/ui/gui.py` 添加标签页：

```python
from src.ui.tabs.my_module_tab import MyModuleTab

# 在 _setup_ui 方法中
my_module_tab = MyModuleTab(self.notebook)
self.notebook.add(my_module_tab.frame, text="我的模块")
```

## 步骤6: 添加配置文件

在 `config/` 创建模块配置：

```yaml
# config/my_module_config.yaml
module:
  name: "我的模块"
  enabled: true
  settings:
    timeout: 30
    retry: 3
```

## 最佳实践

1. **遵循命名规范**: 使用清晰的命名，step_id使用前缀分类
2. **错误处理**: 每个步骤都应有适当的错误处理
3. **日志记录**: 关键操作都应记录日志
4. **配置驱动**: 尽量使用配置而不是硬编码
5. **测试**: 为新模块编写测试用例

## 示例

参考现有模块的实现方式：
- 查看项目结构了解组织方式
- 参考 CLAUDE.md 了解架构模式
- 遵循现有代码的风格和约定
